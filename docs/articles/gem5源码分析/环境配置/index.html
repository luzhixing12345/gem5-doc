<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>
        Document
    </title>
    <link rel='stylesheet' href=../../../css/index.css />
    <link rel='stylesheet' href=../../../css/c.css /><link rel='stylesheet' href=../../../css/shell.css /><link rel='stylesheet' href=../../../css/json.css /><link rel='stylesheet' href=../../../css/python.css />
    <link rel="icon" href="https://raw.githubusercontent.com/learner-lu/picbed/master/logo.png">
</head>

<body class="light">
    <a href="https://github.com/luzhixing12345/gem5-doc.git" target="_blank" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
    <div class="header-navigator"><ul><li><a href="#h1-0">环境配置</a><ul><li><a href="#h2-1">头文件路径</a></li></ul><ul><li><a href="#h2-2">Python 脚本路径</a></li></ul></li></ul></div><div class='markdown-body'><h1 id="h1-0">环境配置</h1><h2 id="h2-1">头文件路径</h2><p>直接浏览gem5的源码会有很多语法提示的报错, 需要补充头文件的路径</p><blockquote><p>具体可以参考本仓库 <code>.vscode/</code> 文件夹</p></blockquote><p>如果是使用的C++ Extension的 <code>.vscode/c_cpp_properties.json</code> 如下</p><pre class="language-json"><code><span class="Token BraceDepth-0 Object LCURLY_BRACE">{</span><span class="Token Object LF">
</span><span class="Token Object SPACE">    </span><span class="Token Key Pair String STRING">&quot;configurations&quot;</span><span class="Token Pair COLON">:</span><span class="Token Pair SPACE"> </span><span class="Array Token BraceDepth-1 Pair LSQUAR_PAREN">[</span><span class="Array Token Pair LF">
</span><span class="Array Token Pair SPACE">        </span><span class="Token Object BraceDepth-2 LCURLY_BRACE">{</span><span class="Token Object LF">
</span><span class="Token Object SPACE">            </span><span class="Token Key Pair String STRING">&quot;name&quot;</span><span class="Token Pair COLON">:</span><span class="Token Pair SPACE"> </span><span class="Token Pair String STRING">&quot;Linux&quot;</span><span class="Token Object COMMA">,</span><span class="Token Object LF">
</span><span class="Token Object SPACE">            </span><span class="Token Key Pair String STRING">&quot;includePath&quot;</span><span class="Token Pair COLON">:</span><span class="Token Pair SPACE"> </span><span class="Array Token BraceDepth-0 Pair LSQUAR_PAREN">[</span><span class="Array Token Pair LF">
</span><span class="Array Token Pair SPACE">                </span><span class="Token String STRING">&quot;${workspaceFolder}/**&quot;</span><span class="Array Token Pair COMMA">,</span><span class="Array Token Pair LF">
</span><span class="Array Token Pair SPACE">                </span><span class="Token String STRING">&quot;/usr/include&quot;</span><span class="Array Token Pair COMMA">,</span><span class="Array Token Pair LF">
</span><span class="Array Token Pair SPACE">                </span><span class="Token String STRING">&quot;/home/kamilu/gem5/ext/googletest/googletest/include&quot;</span><span class="Array Token Pair COMMA">,</span><span class="Array Token Pair LF">
</span><span class="Array Token Pair SPACE">                </span><span class="Token String STRING">&quot;/usr/include/hdf5/serial&quot;</span><span class="Array Token Pair COMMA">,</span><span class="Array Token Pair LF">
</span><span class="Array Token Pair SPACE">                </span><span class="Token String STRING">&quot;/home/kamilu/sst/include&quot;</span><span class="Array Token Pair COMMA">,</span><span class="Array Token Pair LF">
</span><span class="Array Token Pair SPACE">                </span><span class="Token String STRING">&quot;/home/kamilu/gem5/ext&quot;</span><span class="Array Token Pair COMMA">,</span><span class="Array Token Pair LF">
</span><span class="Array Token Pair SPACE">                </span><span class="Token String STRING">&quot;/home/kamilu/gem5/ext/fputils/include/&quot;</span><span class="Array Token Pair COMMA">,</span><span class="Array Token Pair LF">
</span><span class="Array Token Pair SPACE">                </span><span class="Token String STRING">&quot;/home/kamilu/gem5/ext/googletest/googlemock/include&quot;</span><span class="Array Token Pair COMMA">,</span><span class="Array Token Pair LF">
</span><span class="Array Token Pair SPACE">                </span><span class="Token String STRING">&quot;/home/kamilu/gem5/ext/googletest/googletest/include&quot;</span><span class="Array Token Pair COMMA">,</span><span class="Array Token Pair LF">
</span><span class="Array Token Pair SPACE">                </span><span class="Token String STRING">&quot;/home/kamilu/gem5/ext/nomali/include&quot;</span><span class="Array Token Pair COMMA">,</span><span class="Array Token Pair LF">
</span><span class="Array Token Pair SPACE">                </span><span class="Token String STRING">&quot;/home/kamilu/gem5/ext/pybind11/include&quot;</span><span class="Array Token Pair COMMA">,</span><span class="Array Token Pair LF">
</span><span class="Array Token Pair SPACE">                </span><span class="Token String STRING">&quot;/home/kamilu/gem5/util/m5/src&quot;</span><span class="Array Token Pair COMMA">,</span><span class="Array Token Pair LF">
</span><span class="Array Token Pair SPACE">                </span><span class="Token String STRING">&quot;/usr/include/python3.10&quot;</span><span class="Token String LF">
</span><span class="Token String SPACE">            </span><span class="Array Token BraceDepth-0 Pair RSQUAR_PAREN">]</span><span class="Token Object COMMA">,</span><span class="Token Object LF">
</span><span class="Token Object SPACE">            </span><span class="Token Key Pair String STRING">&quot;defines&quot;</span><span class="Token Pair COLON">:</span><span class="Token Pair SPACE"> </span><span class="Array Token BraceDepth-0 Pair LSQUAR_PAREN">[</span><span class="Array Token Pair LF">
</span><span class="Array Token Pair SPACE">                </span><span class="Token String STRING">&quot;TRACING_ON&quot;</span><span class="Token String LF">
</span><span class="Token String SPACE">            </span><span class="Array Token BraceDepth-0 Pair RSQUAR_PAREN">]</span><span class="Token Object COMMA">,</span><span class="Token Object LF">
</span><span class="Token Object SPACE">            </span><span class="Token Key Pair String STRING">&quot;compilerPath&quot;</span><span class="Token Pair COLON">:</span><span class="Token Pair SPACE"> </span><span class="Token Pair String STRING">&quot;/usr/bin/gcc&quot;</span><span class="Token Object COMMA">,</span><span class="Token Object LF">
</span><span class="Token Object SPACE">            </span><span class="Token Key Pair String STRING">&quot;cStandard&quot;</span><span class="Token Pair COLON">:</span><span class="Token Pair SPACE"> </span><span class="Token Pair String STRING">&quot;c17&quot;</span><span class="Token Object COMMA">,</span><span class="Token Object LF">
</span><span class="Token Object SPACE">            </span><span class="Token Key Pair String STRING">&quot;cppStandard&quot;</span><span class="Token Pair COLON">:</span><span class="Token Pair SPACE"> </span><span class="Token Pair String STRING">&quot;gnu++17&quot;</span><span class="Token Object COMMA">,</span><span class="Token Object LF">
</span><span class="Token Object SPACE">            </span><span class="Token Key Pair String STRING">&quot;intelliSenseMode&quot;</span><span class="Token Pair COLON">:</span><span class="Token Pair SPACE"> </span><span class="Token Pair String STRING">&quot;linux-gcc-x64&quot;</span><span class="Token Pair String LF">
</span><span class="Token Pair String SPACE">        </span><span class="Token Object BraceDepth-2 RCURLY_BRACE">}</span><span class="Token Object LF">
</span><span class="Token Object SPACE">    </span><span class="Array Token BraceDepth-1 Pair RSQUAR_PAREN">]</span><span class="Token Object COMMA">,</span><span class="Token Object LF">
</span><span class="Token Object SPACE">    </span><span class="Token Key Pair String STRING">&quot;version&quot;</span><span class="Token Pair COLON">:</span><span class="Token Pair SPACE"> </span><span class="Token Pair Number NUMBER">4</span><span class="Token Pair Number LF">
</span><span class="Token BraceDepth-0 Object RCURLY_BRACE">}</span></code></pre><p>如果是使用 Clangd, 则需要添加 <code>.vscode/settings.json</code></p><pre class="language-json"><code><span class="Token BraceDepth-0 Object LCURLY_BRACE">{</span><span class="Token Object LF">
</span><span class="Token Object SPACE">    </span><span class="Token Key Pair String STRING">&quot;clangd.fallbackFlags&quot;</span><span class="Token Pair COLON">:</span><span class="Token Pair SPACE"> </span><span class="Array Token BraceDepth-1 Pair LSQUAR_PAREN">[</span><span class="Array Token Pair LF">
</span><span class="Array Token Pair SPACE">        </span><span class="Token String STRING">&quot;-I/home/kamilu/gem5/include&quot;</span><span class="Array Token Pair COMMA">,</span><span class="Array Token Pair LF">
</span><span class="Array Token Pair SPACE">        </span><span class="Token String STRING">&quot;-I/home/kamilu/gem5/src&quot;</span><span class="Array Token Pair COMMA">,</span><span class="Array Token Pair LF">
</span><span class="Array Token Pair SPACE">        </span><span class="Token String STRING">&quot;-I/home/kamilu/gem5/build/X86&quot;</span><span class="Array Token Pair COMMA">,</span><span class="Array Token Pair LF">
</span><span class="Array Token Pair SPACE">        </span><span class="Token String STRING">&quot;-I/usr/include&quot;</span><span class="Array Token Pair COMMA">,</span><span class="Array Token Pair LF">
</span><span class="Array Token Pair SPACE">        </span><span class="Token String STRING">&quot;-I/home/kamilu/gem5/ext/googletest/googletest/include&quot;</span><span class="Array Token Pair COMMA">,</span><span class="Array Token Pair LF">
</span><span class="Array Token Pair SPACE">        </span><span class="Token String STRING">&quot;-I/usr/include/hdf5/serial&quot;</span><span class="Array Token Pair COMMA">,</span><span class="Array Token Pair LF">
</span><span class="Array Token Pair SPACE">        </span><span class="Token String STRING">&quot;-I/home/kamilu/sst/include&quot;</span><span class="Array Token Pair COMMA">,</span><span class="Array Token Pair LF">
</span><span class="Array Token Pair SPACE">        </span><span class="Token String STRING">&quot;-I/home/kamilu/gem5/ext&quot;</span><span class="Array Token Pair COMMA">,</span><span class="Array Token Pair LF">
</span><span class="Array Token Pair SPACE">        </span><span class="Token String STRING">&quot;-I/home/kamilu/gem5/ext/fputils/include/&quot;</span><span class="Array Token Pair COMMA">,</span><span class="Array Token Pair LF">
</span><span class="Array Token Pair SPACE">        </span><span class="Token String STRING">&quot;-I/home/kamilu/gem5/ext/googletest/googlemock/include&quot;</span><span class="Array Token Pair COMMA">,</span><span class="Array Token Pair LF">
</span><span class="Array Token Pair SPACE">        </span><span class="Token String STRING">&quot;-I/home/kamilu/gem5/ext/googletest/googletest/include&quot;</span><span class="Array Token Pair COMMA">,</span><span class="Array Token Pair LF">
</span><span class="Array Token Pair SPACE">        </span><span class="Token String STRING">&quot;-I/home/kamilu/gem5/ext/nomali/include&quot;</span><span class="Array Token Pair COMMA">,</span><span class="Array Token Pair LF">
</span><span class="Array Token Pair SPACE">        </span><span class="Token String STRING">&quot;-I/home/kamilu/gem5/ext/pybind11/include&quot;</span><span class="Array Token Pair COMMA">,</span><span class="Array Token Pair LF">
</span><span class="Array Token Pair SPACE">        </span><span class="Token String STRING">&quot;-I/usr/include/python3.10&quot;</span><span class="Array Token Pair COMMA">,</span><span class="Array Token Pair LF">
</span><span class="Array Token Pair SPACE">        </span><span class="Token String STRING">&quot;-I/home/kamilu/gem5/util/m5/src&quot;</span><span class="Array Token Pair COMMA">,</span><span class="Array Token Pair LF">
</span><span class="Array Token Pair SPACE">        </span><span class="Token String STRING">&quot;-D TRACING_ON&quot;</span><span class="Array Token Pair COMMA">,</span><span class="Array Token Pair LF">
</span><span class="Array Token Pair SPACE">        </span><span class="Token String STRING">&quot;-std=c++17&quot;</span><span class="Token String LF">
</span><span class="Token String SPACE">    </span><span class="Array Token BraceDepth-1 Pair RSQUAR_PAREN">]</span><span class="Array Token Pair LF">
</span><span class="Token BraceDepth-0 Object RCURLY_BRACE">}</span></code></pre><p>其中 <code>/home/kamilu/gem5-cxl</code> 是gem5的根目录, 替换为你的即可</p><ul><li>初次构建使用的是 X86 架构, 构建完成后会生成 <code>build/X86</code> 目录</li></ul><ul><li><code>-D TRACING_ON</code> 是一个调试的宏, 需要在预处理阶段声明</li></ul><ul><li><code>/home/kamilu/sst/include</code> 这个路径是需要编译安装的, 可以参照 <code>ext/sst/INSTALL.md</code> 安装. 用于解决 <code>&lt;sst/core/sst_config.h&gt;</code>的头文件依赖<pre class="language-shell"><code><span class="Token COMMENT"># /home/kamilu/sst 安装位置</span><span class="Token LF">
</span><span class="Token Program ID">mkdir</span><span class="Token SPACE"> </span><span class="Token ID">sst</span><span class="Token LF">
</span><span class="Program Token Variant ID">SST_CORE_HOME</span><span class="Token ASSIGN">=</span><span class="Token PATH">/home/kamilu/sst</span><span class="Token LF">
</span><span class="Token LF">
</span><span class="Token Program ID">wget</span><span class="Token SPACE"> </span><span class="Token Url ID">https://github.com/sstsimulator/sst-core/releases/download/v11.1.0_Final/sstcore-11.1.0.tar.gz</span><span class="Token LF">
</span><span class="Token Program ID">tar</span><span class="Token SPACE"> </span><span class="Token ID">xf</span><span class="Token SPACE"> </span><span class="Token ID">sstcore-11.1.0.tar.gz</span><span class="Token LF">
</span><span class="Token Keyword CD">cd</span><span class="Token SPACE"> </span><span class="Token ID">sstcore-11.1.0</span><span class="Token LF">
</span><span class="Token Program PATH">./configure</span><span class="Token SPACE"> </span><span class="Token OPTION">--prefix</span><span class="Token ASSIGN">=</span><span class="Token VARIANT">$SST_CORE_HOME</span><span class="Token SPACE"> </span><span class="Token OPTION">--with-python</span><span class="Token ASSIGN">=</span><span class="Token PATH">/usr/bin/python3-config</span><span class="Token LF">
</span><span class="Token Program ID">make</span><span class="Token SPACE"> </span><span class="Token ID">all</span><span class="Token SPACE"> </span><span class="Token OPTION">-j</span><span class="Token DOLLAR">$</span><span class="Token BraceDepth-0 LPAREN">(</span><span class="Token Program ID">nproc</span><span class="Token BraceDepth-0 RPAREN">)</span><span class="Token LF">
</span><span class="Token Program ID">make</span><span class="Token SPACE"> </span><span class="Token ID">install</span><span class="Token LF">
</span><span class="Token Program ID">echo</span><span class="Token SPACE"> </span><span class="Token String STRING">&quot;export PATH=$SST_CORE_HOME/bin:$PATH&quot;</span><span class="Token SPACE"> </span><span class="Token SHR">&gt;&gt;</span><span class="Token SPACE"> </span><span class="Token TILDE">~</span><span class="Token PATH">/.bashrc</span><span class="Token LF">
</span><span class="Token Program ID">source</span><span class="Token SPACE"> </span><span class="Token TILDE">~</span><span class="Token PATH">/.bashrc</span><span class="Token LF">
</span><span class="Token Program ID">wget</span><span class="Token SPACE"> </span><span class="Token Url ID">https://github.com/sstsimulator/sst-elements/releases/download/v11.1.0_Final/sstelements-11.1.0.tar.gz</span><span class="Token LF">
</span><span class="Token Program ID">tar</span><span class="Token SPACE"> </span><span class="Token ID">xf</span><span class="Token SPACE"> </span><span class="Token ID">sstelements-11.1.0.tar.gz</span><span class="Token LF">
</span><span class="Token Keyword CD">cd</span><span class="Token SPACE"> </span><span class="Token ID">sst-elements-library-11.1.0</span><span class="Token LF">
</span><span class="Token Program PATH">./configure</span><span class="Token SPACE"> </span><span class="Token OPTION">--prefix</span><span class="Token ASSIGN">=</span><span class="Token VARIANT">$SST_CORE_HOME</span><span class="Token SPACE"> </span><span class="Token OPTION">--with-python</span><span class="Token ASSIGN">=</span><span class="Token PATH">/usr/bin/python3-config</span><span class="Token SPACE"> </span><span class="Token BACK_SLASH">\</span><span class="Token LF">
</span><span class="Token SPACE">            </span><span class="Token OPTION">--with-sst-core</span><span class="Token ASSIGN">=</span><span class="Token VARIANT">$SST_CORE_HOME</span><span class="Token LF">
</span><span class="Token Program ID">make</span><span class="Token SPACE"> </span><span class="Token ID">all</span><span class="Token SPACE"> </span><span class="Token OPTION">-j</span><span class="Token DOLLAR">$</span><span class="Token BraceDepth-0 LPAREN">(</span><span class="Token Program ID">nproc</span><span class="Token BraceDepth-0 RPAREN">)</span><span class="Token LF">
</span><span class="Token Program ID">make</span><span class="Token SPACE"> </span><span class="Token ID">install</span><span class="Token LF">
</span><span class="Token Program ID">echo</span><span class="Token SPACE"> </span><span class="Token String STRING">&quot;export PKG_CONFIG_PATH=$PKG_CONFIG_PATH:$SST_CORE_HOME/lib/pkgconfig/&quot;</span><span class="Token SPACE"> </span><span class="Token SHR">&gt;&gt;</span><span class="Token SPACE"> </span><span class="Token TILDE">~</span><span class="Token PATH">/.bashrc</span><span class="Token LF">
</span><span class="Token Program ID">source</span><span class="Token SPACE"> </span><span class="Token TILDE">~</span><span class="Token PATH">/.bashrc</span></code></pre><p>安装之后将 <code>include/</code> 目录加入头文件路径即可</p></li></ul><ul><li><code>/usr/include/hdf5/serial</code> 路径是在初次构建gem5的时候 <code>sudo apt install libhdf5-dev</code> 安装的</li></ul><ul><li>代码中使用到了高C++标准, 需要使用std=c++17标准</li></ul><p>重启vscode之后应该是没有语法报错提示了, 当然如果去浏览 <code>src/arch</code> 下的不是X86架构的仍然会报错, 因为你需要使用 scons 构建对应架构的gem5.opt</p><h2 id="h2-2">Python 脚本路径</h2><p>你可能注意到了我们使用的 <code>simple.py</code> 文件中有很多没有高亮的部分, 我们使用 <code>import m5</code> 的时候也并没有成功的提示相关信息, 这给我们阅读和编写代码造成了很大的困扰, 毕竟智能提示还是很有帮助的, 而且满屏的报错看起来也并不优雅</p><p>这个问题至今并没有一个很好的解决办法, 不过我暂时找到了一个解决方法, 你可以经过简单的配置而达到如下的效果</p><blockquote><p>当然,可以跳转和提示</p></blockquote><p><a data-lightbox="example-1" href="https://raw.githubusercontent.com/learner-lu/picbed/master/20230404101846.png"><img src="https://raw.githubusercontent.com/learner-lu/picbed/master/20230404101846.png" alt="20230404101846"></a></p><p><a data-lightbox="example-1" href="https://raw.githubusercontent.com/learner-lu/picbed/master/20230404102048.png"><img src="https://raw.githubusercontent.com/learner-lu/picbed/master/20230404102048.png" alt="20230404102048"></a></p><p>方法也很简单, 首先在 .vscode/settings.json 中加入 python 的补充搜索路径</p><pre class="language-json"><code><span class="Token BraceDepth-0 Object LCURLY_BRACE">{</span><span class="Token Object LF">
</span><span class="Token Object SPACE">    </span><span class="Token Key Pair String STRING">&quot;[python]&quot;</span><span class="Token Pair COLON">:</span><span class="Token Pair SPACE"> </span><span class="BraceDepth-1 Token Object Pair LCURLY_BRACE">{</span><span class="Token Object Pair LF">
</span><span class="Token Object Pair SPACE">        </span><span class="Token Key Pair String STRING">&quot;editor.defaultFormatter&quot;</span><span class="Token Pair COLON">:</span><span class="Token Pair SPACE"> </span><span class="Token Pair String STRING">&quot;ms-python.autopep8&quot;</span><span class="Token Pair String LF">
</span><span class="Token Pair String SPACE">    </span><span class="BraceDepth-1 Token Object Pair RCURLY_BRACE">}</span><span class="Token Object Pair LF">
</span><span class="Token BraceDepth-0 Object RCURLY_BRACE">}</span></code></pre><p>其次运行本仓库中位于根目录的python程序 <code>scripts/gen_import_path.py</code>, 这个程序并不复杂, 就是搜索 src/ 目录下的所有 py 文件, 将其中所有的 class 和 py 文件对应的 module_path 保存在一个字典中, 最后将结果输出到一个文件 <code>gem5_import.py</code> 中</p><pre class="language-python"><code><span class="Token LF">
</span><span class="Token IMPORT">import</span><span class="Token SPACE"> </span><span class="Token ImportLibName ID">os</span><span class="Token LF">
</span><span class="Token IMPORT">import</span><span class="Token SPACE"> </span><span class="Token ImportLibName ID">ast</span><span class="Token LF">
</span><span class="Token LF">
</span><span class="Token DEF">def</span><span class="Token SPACE"> </span><span class="Token FunctionName ID">get_class_names</span><span class="Token BraceDepth-0 LPAREN">(</span><span class="Token ID">file_name</span><span class="Token BraceDepth-0 RPAREN">)</span><span class="Token COLON">:</span><span class="Token LF">
</span><span class="Token SPACE">    </span><span class="Token WITH">with</span><span class="Token SPACE"> </span><span class="FunctionCall Token ID">open</span><span class="Token BraceDepth-0 LPAREN">(</span><span class="Token ID">file_name</span><span class="Token COMMA">,</span><span class="Token SPACE"> </span><span class="Token STR">&#x27;r&#x27;</span><span class="Token BraceDepth-0 RPAREN">)</span><span class="Token SPACE"> </span><span class="Token AS">as</span><span class="Token SPACE"> </span><span class="Token ID">file</span><span class="Token COLON">:</span><span class="Token LF">
</span><span class="Token SPACE">        </span><span class="Token ID">source</span><span class="Token SPACE"> </span><span class="Token ASSIGN">=</span><span class="Token SPACE"> </span><span class="Token ID">file</span><span class="Token DOT">.</span><span class="FunctionCall Token ID">read</span><span class="Token BraceDepth-0 LPAREN">(</span><span class="Token BraceDepth-0 RPAREN">)</span><span class="Token LF">
</span><span class="Token SPACE">    </span><span class="Token ID">tree</span><span class="Token SPACE"> </span><span class="Token ASSIGN">=</span><span class="Token SPACE"> </span><span class="Token ID">ast</span><span class="Token DOT">.</span><span class="FunctionCall Token ID">parse</span><span class="Token BraceDepth-0 LPAREN">(</span><span class="Token ID">source</span><span class="Token BraceDepth-0 RPAREN">)</span><span class="Token LF">
</span><span class="Token SPACE">    </span><span class="Token ID">class_names</span><span class="Token SPACE"> </span><span class="Token ASSIGN">=</span><span class="Token SPACE"> </span><span class="Token BraceDepth-0 LSQUAR_PAREN">[</span><span class="Token BraceDepth-0 RSQUAR_PAREN">]</span><span class="Token LF">
</span><span class="Token SPACE">    </span><span class="Token FOR">for</span><span class="Token SPACE"> </span><span class="Token ID">node</span><span class="Token SPACE"> </span><span class="Token IN">in</span><span class="Token SPACE"> </span><span class="Token ID">ast</span><span class="Token DOT">.</span><span class="FunctionCall Token ID">walk</span><span class="Token BraceDepth-0 LPAREN">(</span><span class="Token ID">tree</span><span class="Token BraceDepth-0 RPAREN">)</span><span class="Token COLON">:</span><span class="Token LF">
</span><span class="Token SPACE">        </span><span class="Token IF">if</span><span class="Token SPACE"> </span><span class="FunctionCall Token ID">isinstance</span><span class="Token BraceDepth-0 LPAREN">(</span><span class="Token ID">node</span><span class="Token COMMA">,</span><span class="Token SPACE"> </span><span class="Token ID">ast</span><span class="Token DOT">.</span><span class="Token ID">ClassDef</span><span class="Token BraceDepth-0 RPAREN">)</span><span class="Token COLON">:</span><span class="Token LF">
</span><span class="Token SPACE">            </span><span class="Token ID">class_names</span><span class="Token DOT">.</span><span class="FunctionCall Token ID">append</span><span class="Token BraceDepth-0 LPAREN">(</span><span class="Token ID">node</span><span class="Token DOT">.</span><span class="Token ID">name</span><span class="Token BraceDepth-0 RPAREN">)</span><span class="Token LF">
</span><span class="Token SPACE">    </span><span class="Token RETURN">return</span><span class="Token SPACE"> </span><span class="Token ID">class_names</span><span class="Token LF">
</span><span class="Token LF">
</span><span class="Token DEF">def</span><span class="Token SPACE"> </span><span class="Token FunctionName ID">extract_class_names</span><span class="Token BraceDepth-0 LPAREN">(</span><span class="Token ID">file_path</span><span class="Token BraceDepth-0 RPAREN">)</span><span class="Token COLON">:</span><span class="Token LF">
</span><span class="Token SPACE">    </span><span class="Token WITH">with</span><span class="Token SPACE"> </span><span class="FunctionCall Token ID">open</span><span class="Token BraceDepth-0 LPAREN">(</span><span class="Token ID">file_path</span><span class="Token COMMA">,</span><span class="Token SPACE"> </span><span class="Token STR">&#x27;r&#x27;</span><span class="Token BraceDepth-0 RPAREN">)</span><span class="Token SPACE"> </span><span class="Token AS">as</span><span class="Token SPACE"> </span><span class="Token ID">f</span><span class="Token COLON">:</span><span class="Token LF">
</span><span class="Token SPACE">        </span><span class="Token ID">lines</span><span class="Token SPACE"> </span><span class="Token ASSIGN">=</span><span class="Token SPACE"> </span><span class="Token ID">f</span><span class="Token DOT">.</span><span class="FunctionCall Token ID">readlines</span><span class="Token BraceDepth-0 LPAREN">(</span><span class="Token BraceDepth-0 RPAREN">)</span><span class="Token LF">
</span><span class="Token SPACE">        </span><span class="Token ID">class_names</span><span class="Token SPACE"> </span><span class="Token ASSIGN">=</span><span class="Token SPACE"> </span><span class="Token BraceDepth-0 LSQUAR_PAREN">[</span><span class="Token ID">line</span><span class="Token DOT">.</span><span class="FunctionCall Token ID">split</span><span class="BraceDepth-1 Token LPAREN">(</span><span class="Token STR">&quot; &quot;</span><span class="BraceDepth-1 Token RPAREN">)</span><span class="BraceDepth-1 Token LSQUAR_PAREN">[</span><span class="Token NUMBER">1</span><span class="BraceDepth-1 Token RSQUAR_PAREN">]</span><span class="Token SPACE"> </span><span class="Token FOR">for</span><span class="Token SPACE"> </span><span class="Token ID">line</span><span class="Token SPACE"> </span><span class="Token IN">in</span><span class="Token SPACE"> </span><span class="Token ID">lines</span><span class="Token SPACE"> </span><span class="Token IF">if</span><span class="Token SPACE"> </span><span class="Token ID">line</span><span class="Token DOT">.</span><span class="FunctionCall Token ID">startswith</span><span class="BraceDepth-1 Token LPAREN">(</span><span class="Token STR">&quot;class&quot;</span><span class="BraceDepth-1 Token RPAREN">)</span><span class="Token BraceDepth-0 RSQUAR_PAREN">]</span><span class="Token LF">
</span><span class="Token SPACE">        </span><span class="Token RETURN">return</span><span class="Token SPACE"> </span><span class="Token ID">class_names</span><span class="Token LF">
</span><span class="Token LF">
</span><span class="Token DEF">def</span><span class="Token SPACE"> </span><span class="Token FunctionName ID">search_files</span><span class="Token BraceDepth-0 LPAREN">(</span><span class="Token ID">root_dir</span><span class="Token BraceDepth-0 RPAREN">)</span><span class="Token COLON">:</span><span class="Token LF">
</span><span class="Token SPACE">    </span><span class="Token ID">class_dict</span><span class="Token SPACE"> </span><span class="Token ASSIGN">=</span><span class="Token SPACE"> </span><span class="Token BraceDepth-0 LCURLY_BRACE">{</span><span class="Token BraceDepth-0 RCURLY_BRACE">}</span><span class="Token LF">
</span><span class="Token SPACE">    </span><span class="Token FOR">for</span><span class="Token SPACE"> </span><span class="Token ID">dirpath</span><span class="Token COMMA">,</span><span class="Token SPACE"> </span><span class="Token ID">dirnames</span><span class="Token COMMA">,</span><span class="Token SPACE"> </span><span class="Token ID">filenames</span><span class="Token SPACE"> </span><span class="Token IN">in</span><span class="Token SPACE"> </span><span class="Token ID">os</span><span class="Token DOT">.</span><span class="FunctionCall Token ID">walk</span><span class="Token BraceDepth-0 LPAREN">(</span><span class="Token ID">root_dir</span><span class="Token BraceDepth-0 RPAREN">)</span><span class="Token COLON">:</span><span class="Token LF">
</span><span class="Token SPACE">        </span><span class="Token FOR">for</span><span class="Token SPACE"> </span><span class="Token ID">filename</span><span class="Token SPACE"> </span><span class="Token IN">in</span><span class="Token SPACE"> </span><span class="Token ID">filenames</span><span class="Token COLON">:</span><span class="Token LF">
</span><span class="Token SPACE">            </span><span class="Token IF">if</span><span class="Token SPACE"> </span><span class="Token ID">filename</span><span class="Token DOT">.</span><span class="FunctionCall Token ID">endswith</span><span class="Token BraceDepth-0 LPAREN">(</span><span class="Token STR">&#x27;.py&#x27;</span><span class="Token BraceDepth-0 RPAREN">)</span><span class="Token COLON">:</span><span class="Token LF">
</span><span class="Token SPACE">                </span><span class="Token ID">file_path</span><span class="Token SPACE"> </span><span class="Token ASSIGN">=</span><span class="Token SPACE"> </span><span class="Token ID">os</span><span class="Token DOT">.</span><span class="Token ID">path</span><span class="Token DOT">.</span><span class="FunctionCall Token ID">join</span><span class="Token BraceDepth-0 LPAREN">(</span><span class="Token ID">dirpath</span><span class="Token COMMA">,</span><span class="Token SPACE"> </span><span class="Token ID">filename</span><span class="Token BraceDepth-0 RPAREN">)</span><span class="Token LF">
</span><span class="Token SPACE">                </span><span class="Token ID">module_path</span><span class="Token SPACE"> </span><span class="Token ASSIGN">=</span><span class="Token SPACE"> </span><span class="Token ID">file_path</span><span class="Token DOT">.</span><span class="FunctionCall Token ID">replace</span><span class="Token BraceDepth-0 LPAREN">(</span><span class="Token STR">&#x27;.py&#x27;</span><span class="Token COMMA">,</span><span class="Token STR">&#x27;&#x27;</span><span class="Token BraceDepth-0 RPAREN">)</span><span class="Token DOT">.</span><span class="FunctionCall Token ID">replace</span><span class="Token BraceDepth-0 LPAREN">(</span><span class="Token STR">&#x27;/&#x27;</span><span class="Token COMMA">,</span><span class="Token STR">&#x27;.&#x27;</span><span class="Token BraceDepth-0 RPAREN">)</span><span class="Token LF">
</span><span class="Token SPACE">                </span><span class="Token IF">if</span><span class="Token SPACE"> </span><span class="Token ID">class_dict</span><span class="Token DOT">.</span><span class="FunctionCall Token ID">get</span><span class="Token BraceDepth-0 LPAREN">(</span><span class="Token ID">module_path</span><span class="Token BraceDepth-0 RPAREN">)</span><span class="Token SPACE"> </span><span class="Token IS">is</span><span class="Token SPACE"> </span><span class="Token NONE">None</span><span class="Token COLON">:</span><span class="Token LF">
</span><span class="Token SPACE">                    </span><span class="Token ID">class_dict</span><span class="Token BraceDepth-0 LSQUAR_PAREN">[</span><span class="Token ID">module_path</span><span class="Token BraceDepth-0 RSQUAR_PAREN">]</span><span class="Token SPACE"> </span><span class="Token ASSIGN">=</span><span class="Token SPACE"> </span><span class="Token BraceDepth-0 LSQUAR_PAREN">[</span><span class="Token BraceDepth-0 RSQUAR_PAREN">]</span><span class="Token LF">
</span><span class="Token SPACE">                </span><span class="Token ID">class_names</span><span class="Token SPACE"> </span><span class="Token ASSIGN">=</span><span class="Token SPACE"> </span><span class="FunctionCall Token ID">get_class_names</span><span class="Token BraceDepth-0 LPAREN">(</span><span class="Token ID">file_path</span><span class="Token BraceDepth-0 RPAREN">)</span><span class="Token LF">
</span><span class="Token SPACE">                </span><span class="Token IF">if</span><span class="Token SPACE"> </span><span class="Token ID">class_names</span><span class="Token COLON">:</span><span class="Token LF">
</span><span class="Token SPACE">                    </span><span class="Token ID">class_dict</span><span class="Token BraceDepth-0 LSQUAR_PAREN">[</span><span class="Token ID">module_path</span><span class="Token BraceDepth-0 RSQUAR_PAREN">]</span><span class="Token DOT">.</span><span class="FunctionCall Token ID">extend</span><span class="Token BraceDepth-0 LPAREN">(</span><span class="Token ID">class_names</span><span class="Token BraceDepth-0 RPAREN">)</span><span class="Token LF">
</span><span class="Token SPACE">    </span><span class="Token RETURN">return</span><span class="Token SPACE"> </span><span class="Token ID">class_dict</span><span class="Token LF">
</span><span class="Token LF">
</span><span class="Token IF">if</span><span class="Token SPACE"> </span><span class="Token ID">__name__</span><span class="Token SPACE"> </span><span class="Token ASSIGN">=</span><span class="Token ASSIGN">=</span><span class="Token SPACE"> </span><span class="Token STR">&#x27;__main__&#x27;</span><span class="Token COLON">:</span><span class="Token LF">
</span><span class="Token SPACE">    </span><span class="Token ID">class_dict</span><span class="Token SPACE"> </span><span class="Token ASSIGN">=</span><span class="Token SPACE"> </span><span class="FunctionCall Token ID">search_files</span><span class="Token BraceDepth-0 LPAREN">(</span><span class="Token STR">&#x27;src&#x27;</span><span class="Token BraceDepth-0 RPAREN">)</span><span class="Token LF">
</span><span class="Token SPACE">    </span><span class="Token LF">
</span><span class="Token SPACE">    </span><span class="Token WITH">with</span><span class="Token SPACE"> </span><span class="FunctionCall Token ID">open</span><span class="Token BraceDepth-0 LPAREN">(</span><span class="Token STR">&#x27;gem5_import.py&#x27;</span><span class="Token COMMA">,</span><span class="Token STR">&#x27;w&#x27;</span><span class="Token COMMA">,</span><span class="Token ID">encoding</span><span class="Token ASSIGN">=</span><span class="Token STR">&#x27;utf-8&#x27;</span><span class="Token BraceDepth-0 RPAREN">)</span><span class="Token SPACE"> </span><span class="Token AS">as</span><span class="Token SPACE"> </span><span class="Token ID">f</span><span class="Token COLON">:</span><span class="Token LF">
</span><span class="Token SPACE">        </span><span class="Token FOR">for</span><span class="Token SPACE"> </span><span class="Token ID">module_path</span><span class="Token COMMA">,</span><span class="Token SPACE"> </span><span class="Token ID">class_names</span><span class="Token SPACE"> </span><span class="Token IN">in</span><span class="Token SPACE"> </span><span class="Token ID">class_dict</span><span class="Token DOT">.</span><span class="FunctionCall Token ID">items</span><span class="Token BraceDepth-0 LPAREN">(</span><span class="Token BraceDepth-0 RPAREN">)</span><span class="Token COLON">:</span><span class="Token LF">
</span><span class="Token SPACE">            </span><span class="Token FOR">for</span><span class="Token SPACE"> </span><span class="Token ID">class_name</span><span class="Token SPACE"> </span><span class="Token IN">in</span><span class="Token SPACE"> </span><span class="Token ID">class_names</span><span class="Token COLON">:</span><span class="Token LF">
</span><span class="Token SPACE">                </span><span class="Token ID">f</span><span class="Token DOT">.</span><span class="FunctionCall Token ID">write</span><span class="Token BraceDepth-0 LPAREN">(</span><span class="Token ID">f</span><span class="Token STR">&#x27;from {module_path} import {class_name}\n&#x27;</span><span class="Token BraceDepth-0 RPAREN">)</span></code></pre><p>运行此程序之后 <code>gem5_import.py</code> 大致如下所示, 其中已经引入了几乎所有相关的类</p><p><a data-lightbox="example-1" href="https://raw.githubusercontent.com/learner-lu/picbed/master/20230404102739.png"><img src="https://raw.githubusercontent.com/learner-lu/picbed/master/20230404102739.png" alt="20230404102739"></a></p><p>最后我们只需要在程序中简单 import 一下这个文件就可以了, 如果需要运行则只需要将第三行注释即可</p><pre class="language-python"><code><span class="Token IMPORT">import</span><span class="Token SPACE"> </span><span class="Token ImportLibName ID">m5</span><span class="Token LF">
</span><span class="Token FROM">from</span><span class="Token SPACE"> </span><span class="Token ImportLibName ID">m5</span><span class="Token DOT">.</span><span class="Token ID">objects</span><span class="Token SPACE"> </span><span class="Token IMPORT">import</span><span class="Token SPACE"> </span><span class="Token ImportLibName MUL">*</span><span class="Token LF">
</span><span class="Token FROM">from</span><span class="Token SPACE"> </span><span class="Token ImportLibName ID">gem5_import</span><span class="Token SPACE"> </span><span class="Token IMPORT">import</span><span class="Token SPACE"> </span><span class="Token ImportLibName MUL">*</span></code></pre><p>不过这个程序也有一点点小问题, 比如对于 gpu 这个路径, 使用了 import 不支持的 <code>-</code>, 我们可以使用 importlib 来动态引入或者使用 sys.path.append 来做路径补充, 但无关紧要且无伤大雅～</p><p><a data-lightbox="example-1" href="https://raw.githubusercontent.com/learner-lu/picbed/master/20230404103056.png"><img src="https://raw.githubusercontent.com/learner-lu/picbed/master/20230404103056.png" alt="20230404103056"></a></p></div>
    <div class="dir-tree"><ul><li><a href="../../md-docs/README" >README</a></li></ul><ul><li><a href="../../gem5的编译和使用/gem5简介" >gem5的编译和使用</a><ul><li><a href="../../gem5的编译和使用/gem5简介" >gem5简介</a></li></ul><ul><li><a href="../../gem5的编译和使用/安装与构建" >安装与构建</a></li></ul><ul><li><a href="../../gem5的编译和使用/第一个程序" >第一个程序</a></li></ul><ul><li><a href="../../gem5的编译和使用/全系统模拟" >全系统模拟</a></li></ul><ul><li><a href="../../gem5的编译和使用/linux-kernel构建" >linux-kernel构建</a></li></ul><ul><li><a href="../../gem5的编译和使用/性能测试与统计结果" >性能测试与统计结果</a></li></ul></li></ul><ul><li><a href="../../pybind11/环境配置" >pybind11</a><ul><li><a href="../../pybind11/环境配置" >环境配置</a></li></ul><ul><li><a href="../../pybind11/基础语法" >基础语法</a></li></ul><ul><li><a href="../../pybind11/面向对象" >面向对象</a></li></ul></li></ul><ul><li><a href="../../gem5源码分析/环境配置" >gem5源码分析</a><ul><li><a href="../../gem5源码分析/环境配置" >环境配置</a></li></ul><ul><li><a href="../../gem5源码分析/scons编译流程" >scons编译流程</a></li></ul><ul><li><a href="../../gem5源码分析/gem5启动流程" >gem5启动流程</a></li></ul><ul><li><a href="../../gem5源码分析/SimObject" >SimObject</a></li></ul></li></ul><ul><li><a href="../../cxl/研究进展" >cxl</a><ul><li><a href="../../cxl/研究进展" >研究进展</a></li></ul><ul><li><a href="../../cxl/cxl设备实现" >cxl设备实现</a></li></ul></li></ul></div>
    <div class="zood"><a class="" href="https://github.com/luzhixing12345/zood" target="_blank">zood</a></div>
    <script type="text/javascript" src="../../../js/next_front.js"></script><script>addLink("../../pybind11/面向对象","../../gem5源码分析/scons编译流程","ab")</script><script type="text/javascript" src="../../../js/change_mode.js"></script><script>addChangeModeButton("../../../img/sun.png","../../../img/moon.png")</script><script type="text/javascript" src="../../../js/copy_code.js"></script><script>addCodeCopy("../../../img/before_copy.png","../../../img/after_copy.png")</script><script type="text/javascript" src="../../../js/navigator.js"></script><script type="text/javascript" src="../../../js/picture_preview.js"></script><script type="text/javascript" src="../../../js/global_js_configuration.js"></script>
</body>

</html>